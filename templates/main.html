{% extends "base.html" %}

{% block title %}ON:AIR{% endblock %}
{% block body_class %}{% endblock %}

{% block head %}
  <link rel="stylesheet" href="{{ url_for('static', filename='styles/main.css') }}" />
  <style>
    /* ê°œë°œììš© API íŒ¨ë„ (ê¸°ë³¸ ìˆ¨ê¹€) */
    #api-panel {
      display:none;
      position:fixed;right:16px;top:84px;z-index:9999;background:#fff;
      border:1px solid #e5e7eb;border-radius:12px;padding:12px 12px 10px 12px;
      box-shadow:0 6px 20px rgba(0,0,0,.08);width:310px;
      font-family:ui-sans-serif,system-ui;font-size:13px;
    }
    #api-panel h4{margin:0 0 8px;font-size:14px;font-weight:700}
    #api-panel small{color:#6b7280}
    #api-panel .row{display:flex;gap:6px;margin-top:8px}
    #api-panel input{flex:1;border:1px solid #d1d5db;border-radius:8px;padding:8px;font-size:12px}
    #api-panel button{border:0;background:#4f46e5;color:#fff;border-radius:8px;padding:8px 10px;font-size:12px;cursor:pointer}
    #api-panel .pill{display:inline-block;padding:2px 8px;border-radius:999px;font-size:11px;margin-left:6px}
    #api-panel .ok{background:#ecfdf5;color:#065f46}
    #api-panel .bad{background:#fef2f2;color:#991b1b}

    /* ===============================
       ì˜¤ëŠ˜ì˜ ì „í™” íŒ (íŒì—… ëª¨ë‹¬)
    ================================ */
    #tip-modal {
      display: none;
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0, 0, 0, 0.45);
      z-index: 9999;
      justify-content: center;
      align-items: center;
      animation: fadeIn 0.4s ease;
    }
    @keyframes fadeIn {
      from {opacity: 0;}
      to {opacity: 1;}
    }
    .tip-content {
      background: #ffffff;
      border-radius: 20px;
      width: 90%;
      max-width: 420px;
      padding: 28px 24px;
      text-align: center;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
      animation: popUp 0.4s ease;
    }
    @keyframes popUp {
      from {transform: translateY(30px); opacity: 0;}
      to {transform: translateY(0); opacity: 1;}
    }
    .tip-content h3 {
      color: #465fe8;
      font-size: 1.3rem;
      margin-bottom: 10px;
      font-weight: 700;
    }
    .tip-content img {
      width: 70%;
      max-width: 220px;
      height: auto;
      margin: 12px 0 16px;
    }
    .tip-content p {
      font-size: 0.95rem;
      color: #333;
      margin-bottom: 16px;
      line-height: 1.5;
    }
    .tip-btns {
      display: flex;
      justify-content: center;
      gap: 10px;
    }
    .tip-btn {
      border: none;
      border-radius: 10px;
      padding: 8px 16px;
      cursor: pointer;
      font-weight: 600;
      transition: 0.2s;
    }
    .tip-btn.more {
      background: #465fe8;
      color: #fff;
    }
    .tip-btn.more:hover {
      background: #3347c2;
    }
    .tip-btn.close {
      background: #f3f4f6;
      color: #111;
    }
    .tip-btn.close:hover {
      background: #e5e7eb;
    }
  </style>
{% endblock %}

{% block content %}
  <!-- ë°°ê²½ ì˜ìƒ -->
  <video autoplay muted loop playsinline class="bg-video">
    <source src="{{ url_for('static', filename='videos/main.mp4') }}" type="video/mp4" />
    ë¸Œë¼ìš°ì €ê°€ video íƒœê·¸ë¥¼ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
  </video>

  <!-- âœ… ê°œë°œììš© API ìƒíƒœ íŒ¨ë„ -->
  <div id="api-panel" aria-live="polite">
    <h4>API ìƒíƒœ <small id="api-model"></small></h4>
    <div id="api-state" style="margin-bottom:4px">
      <span id="api-provider" class="pill">-</span>
      <span id="api-ok" class="pill bad">DISCONNECTED</span>
    </div>
    <div class="row" role="group" aria-label="API í‚¤ ì…ë ¥">
      <input id="api-key-input" type="password" placeholder="OpenAI(sk-...) ë˜ëŠ” Gemini(AIza...)" />
      <button id="api-key-set" type="button">ë“±ë¡</button>
    </div>
    <small>OpenAI í‚¤: <code>sk-...</code> / Gemini í‚¤: <code>AIza...</code></small>
  </div>

  <main id="content">
    <!-- Hero -->
    <section class="section hero" aria-labelledby="hero-title">
      <div class="text-box">
        <img class="hero-logo reveal from-top soft"
             src="{{ url_for('static', filename='assets/image/onair.svg') }}"
             alt="ON:AIR ë¡œê³ " />
        <h1 id="hero-title" class="hero-title reveal from-bottom pop">
          ë‹¹ì‹ ì˜ AIì™€ í•¨ê»˜,<br>ëŒ€í™”ë¥¼ ë°°ìš°ëŠ” ë‹¹ì‹ ë§Œì˜ ì¥ì†Œ
        </h1>
        <div class="btn-group reveal from-bottom soft" role="group" aria-label="íˆì–´ë¡œ CTA">
          <a href="{{ url_for('roadmap') }}" class="cta-btn">ì§€ê¸ˆ ëŒ€í™”í•´ë³´ê¸°</a>
          <a href="#service-info" class="cta-btn secondary">ì–´ë–¤ ì„œë¹„ìŠ¤ì¸ê°€ìš”?</a>
        </div>
      </div>
    </section>

    <!-- ì´ëŸ° ì‚¬ëŒì—ê²Œ ì¶”ì²œ -->
    <section class="section section-white" aria-labelledby="reason-title">
      <h2 id="reason-title" class="reveal from-bottom">on:airëŠ” ì´ëŸ° ì‚¬ëŒì—ê²Œ í•„ìš”í•´ìš”</h2>
      <ul class="reason-list stagger" style="--stagger:90ms">
        <li class="reason reveal from-bottom"><span class="emoji">ğŸ“</span><p>ì „í™”ë¥¼ ê±¸ê¸° ì „, ë¨¸ë¦¿ì†ì´ ìƒˆí•˜ì–˜ì§€ëŠ” ë¶„</p></li>
        <li class="reason reveal from-bottom"><span class="emoji">ğŸ§â€â™‚ï¸ğŸ§â€â™€ï¸</span><p>ì²˜ìŒ ë§Œë‚˜ëŠ” ì‚¬ëŒê³¼ ë¬´ìŠ¨ ë§ì„ í•´ì•¼ í• ì§€ ë§‰ë§‰í•œ ë¶„</p></li>
        <li class="reason reveal from-bottom"><span class="emoji">ğŸ’¼</span><p>ì·¨ì—… ì¤€ë¹„ ì¤‘, ë©´ì ‘ ë§í•˜ê¸° ì—°ìŠµì´ í•„ìš”í•œ ë¶„</p></li>
        <li class="reason reveal from-bottom"><span class="emoji">ğŸŒ±</span><p>ì‚¬íšŒë¡œ ë‚˜ê°€ëŠ” ê²ƒì´ ì¡°ê¸ˆ ë‘ë ¤ìš´ ë¶„</p></li>
        <li class="reason reveal from-bottom"><span class="emoji">ğŸ—£ï¸</span><p>í˜¼ì£ë§ë¡œ ì—°ìŠµí•˜ë‹¤ ì§€ì¹œ ë¶„</p></li>
      </ul>
      <p class="quote reveal from-bottom soft">
        on:airëŠ” AIì™€ì˜ ëŒ€í™”ë¥¼ í†µí•´<br />
        <strong>â€œì–´ë–»ê²Œ ë§í•´ì•¼ í• ì§€â€</strong>, <strong>â€œë¬´ì—‡ë¶€í„° ë§í•´ì•¼ í• ì§€â€</strong><br />
        ì°¨ê·¼ì°¨ê·¼ í•¨ê»˜ ì—°ìŠµí•´ìš”.
      </p>
    </section>

    <!-- ì‘ë™ ë°©ì‹ -->
    <section id="service-info" class="section section-light" aria-labelledby="how-title">
      <h2 id="how-title" class="reveal from-bottom">ì–´ë–»ê²Œ ì‘ë™í•˜ë‚˜ìš”?</h2>
      <div class="steps stagger" style="--stagger:90ms">
        <article class="step reveal from-bottom"><span class="step-num">1</span><p>ìƒí™© ì„ íƒ<br><small>(ì „í™”, ë©´ì ‘, ì¹œêµ¬ ëŒ€í™” ë“±)</small></p></article>
        <article class="step reveal from-bottom"><span class="step-num">2</span><p>AIì™€ ëŒ€í™” ì‹œì‘<br><small>ë§ˆì¹˜ í†µí™”ì²˜ëŸ¼ ìì—°ìŠ¤ëŸ½ê²Œ</small></p></article>
        <article class="step reveal from-bottom"><span class="step-num">3</span><p>ê°ì • í”¼ë“œë°± & ìš”ì•½<br><small>ë¶„ì„ê³¼ ìš”ì  ì •ë¦¬ ì œê³µ</small></p></article>
        <article class="step reveal from-bottom"><span class="step-num">4</span><p>ê¸°ë¡ìœ¼ë¡œ ì„±ì¥ í™•ì¸<br><small>ë§¤ì¼ì˜ ëŒ€í™”ê°€ ë‚˜ì˜ ì¼ê¸°</small></p></article>
      </div>
      <ul class="steps-notes stagger" style="--stagger:80ms">
        <li class="note reveal from-bottom soft"><strong>ì‹¤ì „ ê°™ì€ ì‹œë‚˜ë¦¬ì˜¤</strong><span>ì „í™” Â· ë©´ì ‘ Â· ì¹œêµ¬ ëŒ€í™” ë“± ìƒí™©ì„ ê³ ë¥´ê³  ë°”ë¡œ ì—°ìŠµí•©ë‹ˆë‹¤.</span></li>
        <li class="note reveal from-bottom soft"><strong>í”¼ë“œë°± & ìš”ì•½</strong><span>ë§ íë¦„ê³¼ í†¤ì„ ë¶„ì„í•´ í¬ì¸íŠ¸ë¥¼ ì§šê³  ìš”ì  ì •ë¦¬ë¥¼ ì œê³µí•©ë‹ˆë‹¤.</span></li>
        <li class="note reveal from-bottom soft"><strong>ê¸°ë¡ìœ¼ë¡œ ì„±ì¥</strong><span>ëŒ€í™”ê°€ ìë™ ê¸°ë¡ë˜ì–´ ë‚˜ì˜ ë³€í™”ë¥¼ í•œëˆˆì— í™•ì¸í•©ë‹ˆë‹¤.</span></li>
      </ul>
    </section>

    <!-- Before & After -->
    <section class="section section-white" aria-labelledby="ba-title">
      <h2 id="ba-title" class="reveal from-bottom">AI ëŒ€í™”ê°€ ì£¼ëŠ” ë³€í™”</h2>
      <div class="before-after">
        <div class="ba-pair">
          <article class="ba-box reveal from-left pop fast"><b>Before</b><p>ì „í™” ì˜¤ë©´ ì‹¬ì¥ì´ ë‘ê·¼ë‘ê·¼</p></article>
          <div class="arrow-wrap reveal soft fast">
            <svg viewBox="0 0 120 10" class="arrow-svg"><defs><marker id="arrowHead-1" markerWidth="8" markerHeight="8" refX="6" refY="3" orient="auto"><polygon points="0 0,6 3,0 6"/></marker></defs><line x1="0" y1="5" x2="110" y2="5" class="arrow-line" marker-end="url(#arrowHead-1)"/></svg>
          </div>
          <article class="ba-box reveal from-right pop fast"><b>After</b><p>â€œì´ë²ˆì—” ë‚´ê°€ ë¨¼ì € ì „í™”í•´ë³¼ê¹Œ?â€</p></article>
        </div>
        <div class="ba-pair">
          <article class="ba-box reveal from-left pop fast"><b>Before</b><p>ë§ì‹¤ìˆ˜í• ê¹Œ ë´ ì…ì„ ë‹¤ë¬¼ë˜ ë‚˜</p></article>
          <div class="arrow-wrap reveal soft fast">
            <svg viewBox="0 0 120 10" class="arrow-svg"><defs><marker id="arrowHead-2" markerWidth="8" markerHeight="8" refX="6" refY="3" orient="auto"><polygon points="0 0,6 3,0 6"/></marker></defs><line x1="0" y1="5" x2="110" y2="5" class="arrow-line" marker-end="url(#arrowHead-2)"/></svg>
          </div>
          <article class="ba-box reveal from-right pop fast"><b>After</b><p>ìƒê°ì„ ë§ë¡œ êº¼ë‚¼ ìˆ˜ ìˆëŠ” ë‚´ê°€ ë¼ìš”</p></article>
        </div>
      </div>
    </section>

    <!-- CTA -->
    <section class="section section-dark section-has-video" aria-labelledby="cta-title">
      <video class="section-video" autoplay muted loop playsinline preload="auto"
             poster="{{ url_for('static', filename='assets/image/friend_poster.png') }}">
        <source src="{{ url_for('static', filename='videos/friend.mp4') }}" type="video/mp4">
        ë¸Œë¼ìš°ì €ê°€ video íƒœê·¸ë¥¼ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
      </video>
      <div class="cta-box reveal from-bottom pop">
        <h2 id="cta-title">ì§€ê¸ˆ ë°”ë¡œ ì‹œì‘í•´ë³´ì„¸ìš”</h2>
        <p>ì‘ì€ ë§ í•œë§ˆë””ì˜ ì—°ìŠµì´<br>ì„¸ìƒê³¼ ì—°ê²°ë˜ëŠ” ì²«ê±¸ìŒì´ ë©ë‹ˆë‹¤.</p>
        <a href="{{ url_for('roadmap') }}" class="cta-btn">AIì™€ ì²« ëŒ€í™” ì‹œì‘í•˜ê¸°</a>
      </div>
    </section>
  </main>

  <!-- âœ… ì˜¤ëŠ˜ì˜ ì „í™” íŒ íŒì—… -->
  <div id="tip-modal">
    <div class="tip-content">
      <h3 id="tip-title">ì˜¤ëŠ˜ì˜ ì „í™” íŒ</h3>
      <img id="tip-img" src="" alt="ì „í™” íŒ ì´ë¯¸ì§€">
      <p id="tip-desc"></p>
      <div class="tip-btns">
        <button class="tip-btn more" id="tip-more">ë”ë³´ê¸°</button>
        <button class="tip-btn close" id="tip-close">ë‹«ê¸°</button>
      </div>
    </div>
  </div>
{% endblock %}

{% block scripts %}
<script>
(() => {
  /* ===== ìŠ¤í¬ë¡¤ ì• ë‹ˆë©”ì´ì…˜ ===== */
  const reduceMotion = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
  const targets = document.querySelectorAll('.reveal');
  if (!('IntersectionObserver' in window) || reduceMotion) {
    targets.forEach(el => el.classList.add('is-visible'));
  } else {
    const io = new IntersectionObserver((entries, obs) => {
      entries.forEach(e => {
        if (e.isIntersecting) {
          e.target.classList.add('is-visible');
          obs.unobserve(e.target);
        }
      });
    }, { threshold: 0.06, rootMargin: '20% 0px -15% 0px' });
    targets.forEach(el => io.observe(el));
    document.querySelectorAll('.stagger').forEach(group => {
      [...group.children].forEach((child, i) => child.style.setProperty('--i', i));
    });
  }

  /* ===== ê°œë°œììš© API íŒ¨ë„ ===== */
  if (window.location.search.includes('dev=1')) {
    document.getElementById('api-panel').style.display = 'block';
    const elProv = document.getElementById('api-provider');
    const elOk = document.getElementById('api-ok');
    const elModel = document.getElementById('api-model');
    const input = document.getElementById('api-key-input');
    const btn = document.getElementById('api-key-set');

    async function loadStatus() {
      try {
        const r = await fetch('/api/status');
        const j = await r.json();
        const ok = !!j.ok;
        elProv.textContent = j.provider ? j.provider.toUpperCase() : 'NONE';
        elOk.textContent = ok ? 'CONNECTED' : 'DISCONNECTED';
        elOk.className = 'pill ' + (ok ? 'ok' : 'bad');
        elModel.textContent = j.model ? `(${j.model})` : '';
      } catch {}
    }

    async function setKey() {
      const key = (input.value || '').trim();
      if (!key) { alert('í‚¤ë¥¼ ì…ë ¥í•´ ì£¼ì„¸ìš”.'); return; }
      try {
        const r = await fetch('/api/key', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ api_key: key })
        });
        const j = await r.json();
        if (!r.ok || !j.ok) alert('ìœ íš¨í•˜ì§€ ì•Šì€ í‚¤ì…ë‹ˆë‹¤.');
        input.value = '';
        loadStatus();
      } catch {
        alert('ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
      }
    }

    btn.addEventListener('click', setKey);
    input.addEventListener('keydown', e => { if (e.key === 'Enter') setKey(); });
    loadStatus();
    setInterval(loadStatus, 4000);
  }

  /* ===== ì˜¤ëŠ˜ì˜ ì „í™” íŒ ===== */
/* ===== ì˜¤ëŠ˜ì˜ ì „í™” íŒ ===== */
const tips = [
  { 
    title: "ì „í™” ë°›ê¸° ì „, ì´ë¦„ë¶€í„° í™•ì¸í•˜ì„¸ìš”", 
    img: "{{ url_for('static', filename='assets/image/tip1.png') }}", 
    desc: "ìƒëŒ€ë°© ì´ë¦„ì„ ë¨¼ì € í™•ì¸í•˜ë©´ ë§íˆ¬ì™€ ì¸ì‚¬ í†¤ì´ ìì—°ìŠ¤ëŸ¬ì›Œì§‘ë‹ˆë‹¤." 
  },
  { 
    title: "ëŠê¸° ì „ í•œ ë§ˆë””, â€˜ì¢‹ì€ í•˜ë£¨ ë³´ë‚´ì„¸ìš”â€™", 
    img: "{{ url_for('static', filename='assets/image/tip2.png') }}", 
    desc: "ë§ˆë¬´ë¦¬ ì¸ì‚¬ëŠ” ìƒëŒ€ë°©ì—ê²Œ ê¸ì •ì ì¸ ì¸ìƒì„ ë‚¨ê¹ë‹ˆë‹¤." 
  },
  { 
    title: "ê¸´ì¥ë  ë• 3ì´ˆ ì‹¬í˜¸í¡", 
    img: "{{ url_for('static', filename='assets/image/tip3.png') }}", 
    desc: "ì „í™” ì „ ì‹¬í˜¸í¡ 3ì´ˆë©´ ëª©ì†Œë¦¬ ë–¨ë¦¼ì´ ì¤„ê³  ìì‹ ê°ì´ ìƒê¹ë‹ˆë‹¤." 
  },
  { 
    title: "í†µí™” ì¤‘ ë©”ëª¨ ìŠµê´€ ë§Œë“¤ê¸°", 
    img: "{{ url_for('static', filename='assets/image/tip4.png') }}", 
    desc: "ê°„ë‹¨í•œ í‚¤ì›Œë“œë¼ë„ ì ì–´ë‘ë©´ ë‚˜ì¤‘ì— ë³µê¸°í•  ë•Œ í° ë„ì›€ì´ ë©ë‹ˆë‹¤." 
  }
];


  const modal = document.getElementById("tip-modal");
  const titleEl = document.getElementById("tip-title");
  const imgEl = document.getElementById("tip-img");
  const descEl = document.getElementById("tip-desc");
  const btnClose = document.getElementById("tip-close");
  const btnMore = document.getElementById("tip-more");

  const today = new Date().toISOString().split('T')[0];
  const lastTipDate = localStorage.getItem('lastTipDate');
  let tipIndex = localStorage.getItem('lastTipIndex');

  /*tip-modal*/
    function showTip(){
      const t = tips[tipIndex];
      titleEl.textContent = t.title;
      imgEl.src = t.img;
      descEl.textContent = t.desc;
      modal.style.display = "flex";
    }

    
    localStorage.removeItem('lastTipDate'); 
  

    if (!lastTipDate || lastTipDate!==today){
      tipIndex = Math.floor(Math.random()*tips.length);
      localStorage.setItem('lastTipIndex', tipIndex);
      localStorage.setItem('lastTipDate',today);
      showTip();
    }
    
  btnClose.addEventListener("click", () => modal.style.display = "none");
  btnMore.addEventListener("click", () => window.location.href = "{{ url_for('tip') }}");
})();
</script>
{% endblock %}
