{% extends "base.html" %}

{% block title %}ì»¤ë®¤ë‹ˆí‹° - ON:AIR{% endblock %}
{% block body_class %}community-page{% endblock %}

{% block head %}
  <link rel="stylesheet" href="{{ url_for('static', filename='styles/community.css') }}">
{% endblock %}

{% block content %}

<!-- ë°°ë„ˆí˜• í—¤ë” (ì´ë¯¸ì§€) -->
<section class="comm-hero">
  <div class="hero-inner">
    <h1>ì»¤ë®¤ë‹ˆí‹°</h1>
    <p>ë¶€ë‹´ ì—†ì´ ìˆ˜ë‹¤ ë–¨ê³ , ì—°ìŠµ íŒë„ ê°€ë³ê²Œ ë‚˜ëˆ„ëŠ” ìš°ë¦¬ ë™ë„¤ ë¼ìš´ì§€</p>
    <div class="chips">
      <a class="chip {% if request.args.get('cat','all')=='all' %}is-active{% endif %}" href="{{ url_for('community', cat='all', q=request.args.get('q'), field=request.args.get('field','title')) }}">ì „ì²´</a>
      <a class="chip {% if request.args.get('cat')=='ë©´ì ‘' %}is-active{% endif %}" href="{{ url_for('community', cat='ë©´ì ‘', q=request.args.get('q'), field=request.args.get('field','title')) }}">ë©´ì ‘</a>
      <a class="chip {% if request.args.get('cat')=='ì „í™”' %}is-active{% endif %}" href="{{ url_for('community', cat='ì „í™”', q=request.args.get('q'), field=request.args.get('field','title')) }}">ì „í™”</a>
      <a class="chip {% if request.args.get('cat')=='ì¼ìƒëŒ€í™”' %}is-active{% endif %}" href="{{ url_for('community', cat='ì¼ìƒëŒ€í™”', q=request.args.get('q'), field=request.args.get('field','title')) }}">ì¼ìƒëŒ€í™”</a>
      <a class="chip {% if request.args.get('cat')=='ë¦¬ë·°' %}is-active{% endif %}" href="{{ url_for('community', cat='ë¦¬ë·°', q=request.args.get('q'), field=request.args.get('field','title')) }}">ë¦¬ë·°/í›„ê¸°</a>
      <a class="chip {% if request.args.get('cat')=='ììœ ' %}is-active{% endif %}" href="{{ url_for('community', cat='ììœ ', q=request.args.get('q'), field=request.args.get('field','title')) }}">ììœ </a>
    </div>
  </div>
</section>

<!-- ê²€ìƒ‰ + ê¸€ì“°ê¸° (ê·¸ë£¹ ìì²´ê°€ ê°€ìš´ë° ì •ë ¬) -->
<section class="toolbar container">
  <div class="toolbar-inner">
    <form class="search search-compact" action="{{ url_for('community') }}" method="get" role="search">
      {% if request.args.get('cat') %}
      <input type="hidden" name="cat" value="{{ request.args.get('cat') }}">
      {% endif %}

      <!-- ì…€ë ‰íŠ¸ (ì•„ì´ì½˜ í¬í•¨ ì•„ë¬´ ê³³ì„ ëˆŒëŸ¬ë„ ì—´ë¦¼) -->
      <label class="field-select" aria-label="ê²€ìƒ‰ ëŒ€ìƒ ì„ íƒ">
        <select name="field" aria-label="ê²€ìƒ‰ ëŒ€ìƒ">
          <option value="title"  {% if request.args.get('field','title')=='title' %}selected{% endif %}>ì œëª©</option>
          <option value="author" {% if request.args.get('field')=='author' %}selected{% endif %}>ì‘ì„±ì</option>
        </select>
        <svg class="chevron-icon" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
          <path d="M6.7 9.3a1 1 0 0 1 1.4 0L12 13.17l3.9-3.87a1 1 0 1 1 1.4 1.42l-4.6 4.56a1 1 0 0 1-1.4 0L6.7 10.7a1 1 0 0 1 0-1.4z" fill="currentColor"/>
        </svg>
      </label>

      <!-- ê²€ìƒ‰ ì…ë ¥ -->
      <div class="input-wrap">
        <input type="search" name="q" value="{{ request.args.get('q','') }}" placeholder="ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”." aria-label="ê²€ìƒ‰ì–´ ì…ë ¥">
        <button type="submit" class="icon-btn" aria-label="ê²€ìƒ‰">
          <svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" focusable="false">
            <path d="M11 4a7 7 0 1 1 0 14 7 7 0 0 1 0-14zm0 2a5 5 0 1 0 0 10 5 5 0 0 0 0-10zm8.707 12.293-3.4-3.4a1 1 0 0 0-1.414 1.414l3.4 3.4a1 1 0 0 0 1.414-1.414z" fill="currentColor"/>
          </svg>
        </button>
      </div>
    </form>

    <!-- ê²€ìƒ‰ì°½ ì˜¤ë¥¸ìª½ì— ë¶™ëŠ” ê¸€ì“°ê¸° ë²„íŠ¼ -->
    <a class="btn primary btn-write" href="{{ url_for('community_new') }}">ê¸€ì“°ê¸°</a>
  </div>
</section>

<!-- ê²Œì‹œê¸€ ë¦¬ìŠ¤íŠ¸ -->
<section class="post-list container" aria-live="polite">
  {% for post in posts %}
  <article class="post-card">
    <a class="cover" href="{{ url_for('community_detail', post_id=post.id) }}" aria-label="{{ post.title }}">
      {% if post.thumbnail %}
        <img src="{{ post.thumbnail }}" alt="" loading="lazy">
      {% else %}
        <div class="thumb-fallback" aria-hidden="true">ON:AIR</div>
      {% endif %}
    </a>

    <div class="card-body">
      <div class="meta-top">
        <span class="badge">{{ post.category or 'ììœ ' }}</span>
        {% if post.tags %}
          <ul class="tags">
            {% for t in post.tags[:3] %}
              <li>#{{ t }}</li>
            {% endfor %}
          </ul>
        {% endif %}
      </div>

      <h2 class="title">
        <a href="{{ url_for('community_detail', post_id=post.id) }}">{{ post.title }}</a>
      </h2>

      <p class="excerpt">
        {{ (post.content|striptags)[:120] }}{% if (post.content|length) > 120 %}â€¦{% endif %}
      </p>

      <div class="meta-bottom">
        <div class="author">
          <div class="avatar" aria-hidden="true">{{ (post.author_name or 'U')[0]|upper }}</div>
          <span class="name">{{ post.author_name or 'ì‚¬ìš©ì' }}</span>
          <span class="dot">Â·</span>
          <time datetime="{{ post.created_at|default('', true) }}">{{ post.created_human or 'ë°©ê¸ˆ ì „' }}</time>
        </div>
        <div class="stats">
          <span title="ì¢‹ì•„ìš”">â¤ {{ post.likes or 0 }}</span>
          <span title="ëŒ“ê¸€">ğŸ’¬ {{ post.comments_count or 0 }}</span>
          <span title="ì¡°íšŒìˆ˜">ğŸ‘ {{ post.views or 0 }}</span>
        </div>
      </div>
    </div>
  </article>
  {% else %}
  <div class="empty">
    <h3>ì•„ì§ ì¡°ìš©í•˜ë„¤ìš”</h3>
    <p>ì˜¤ëŠ˜ ìˆì—ˆë˜ ì¼, ì—°ìŠµ íŒ, ì¡ë‹´â€”ê°€ë³ê²Œ ì²« ê¸€ì„ ì‹œì‘í•´ë³¼ê¹Œìš”?</p>
    <a class="btn primary" href="{{ url_for('community_new') }}">ê¸€ì“°ê¸°</a>
  </div>
  {% endfor %}
</section>

<!-- í˜ì´ì§€ë„¤ì´ì…˜ -->
{% if pagination %}
<nav class="pagination container" aria-label="í˜ì´ì§€ ì´ë™">
  {% if pagination.prev_url %}
    <a class="page" href="{{ pagination.first_url }}" aria-label="ì²« í˜ì´ì§€">Â«</a>
    <a class="page" href="{{ pagination.prev_url }}" aria-label="ì´ì „ í˜ì´ì§€">â€¹</a>
  {% else %}
    <span class="page disabled">Â«</span>
    <span class="page disabled">â€¹</span>
  {% endif %}

  {% for p in pagination.pages %}
    {% if p.is_current %}
      <span class="page is-current" aria-current="page">{{ p.num }}</span>
    {% else %}
      <a class="page" href="{{ p.url }}">{{ p.num }}</a>
    {% endif %}
  {% endfor %}

  {% if pagination.next_url %}
    <a class="page" href="{{ pagination.next_url }}" aria-label="ë‹¤ìŒ í˜ì´ì§€">â€º</a>
    <a class="page" href="{{ pagination.last_url }}" aria-label="ë§ˆì§€ë§‰ í˜ì´ì§€">Â»</a>
  {% else %}
    <span class="page disabled">â€º</span>
    <span class="page disabled">Â»</span>
  {% endif %}
</nav>
{% endif %}

<!-- í”Œë¡œíŒ… + ë²„íŠ¼ (ì¡°ê¸ˆ ì¶•ì†Œ) -->
<a class="fab" href="{{ url_for('community_new') }}" aria-label="ìƒˆ ê¸€ ì‘ì„±">ï¼‹</a>

{% endblock %}

{% block scripts %}
<script>
/* ì•„ì´ì½˜ ì§ì ‘ í´ë¦­ ì‹œë„í•´ë„ í™•ì‹¤íˆ ì—´ë¦¬ë„ë¡ ë³´ê°•(ë¸Œë¼ìš°ì €ë³„ showPicker ì§€ì›) */
document.addEventListener('click', function(e){
  const icon = e.target.closest('.field-select .chevron-icon');
  if (!icon) return;
  const sel = icon.parentElement.querySelector('select');
  if (sel) {
    sel.focus();
    if (typeof sel.showPicker === 'function') { try { sel.showPicker(); } catch(_){} }
    else { sel.click(); }
  }
});
</script>
{% endblock %}
